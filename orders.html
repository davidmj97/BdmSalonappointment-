<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orders - BDM Salon</title>
  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --accent: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
      --border-color: #444;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      padding: 20px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }
    .header h1 {
      font-size: 24px;
    }
    .back-btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .orders-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab {
      flex: 1;
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: #111;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .tab.active {
      background: var(--accent);
      color: white;
    }
    .order-container {
      display: none;
      max-width: 800px;
      margin: 0 auto;
    }
    .order-container.active {
      display: block;
    }
    .order-card {
      background: #111;
      border-radius: 16px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 24px rgba(0,0,0,0.25);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .order-card:hover {
      transform: translateY(-2px);
    }
    .order-summary {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .order-number {
      font-weight: bold;
      color: #90caf9;
      font-size: 15px;
    }
    .customer-name {
      font-weight: 600;
      font-size: 14px;
    }
    .order-date, .order-time {
      font-size: 13px;
      color: #bbb;
    }
    .order-services {
      margin: 5px 0;
      font-size: 13px;
      color: #ddd;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .order-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .order-info span {
      font-size: 14px;
    }
    .order-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .action-btn {
      padding: 5px 15px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }
    .accept-btn {
      background: #4caf50;
      color: white;
    }
    .cancel-btn {
      background: #f44336;
      color: white;
    }
    /* Popup Styles */
    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
    }
    .popup.active {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .popup-content {
      background: #111;
      padding: 20px;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    .popup-close {
      background: none;
      border: none;
      color: #90caf9;
      font-size: 24px;
      cursor: pointer;
    }
    .popup-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    .popup-item {
      background: #222;
      border-radius: 10px;
      padding: 12px;
    }
    .popup-label {
      font-size: 12px;
      color: #bbb;
      margin-bottom: 5px;
    }
    .popup-value {
      font-size: 14px;
      font-weight: 500;
    }
    @media (max-width: 600px) {
      .popup-details {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Orders</h1>
    <button class="back-btn" onclick="window.location.href='customer-dashboard.html'">Back to Dashboard</button>
  </div>
  
  <div class="orders-tabs">
    <div class="tab active" data-tab="pending">Pending Orders</div>
    <div class="tab" data-tab="accepted">Accepted Orders</div>
    <div class="tab" data-tab="cancelled">Cancelled Orders</div>
  </div>

  <div class="order-container active" id="pendingOrders">
    <!-- Pending orders will be inserted here -->
  </div>
  
  <div class="order-container" id="acceptedOrders">
    <!-- Accepted orders will be inserted here -->
  </div>
  
  <div class="order-container" id="cancelledOrders">
    <!-- Cancelled orders will be inserted here -->
  </div>

  <!-- Popup -->
  <div class="popup" id="orderPopup">
    <div class="popup-content">
      <div class="popup-header">
        <h2>Order Details</h2>
        <button class="popup-close" onclick="closePopup()">&times;</button>
      </div>
      <div class="popup-details" id="popupDetails"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const ordersContainer = document.getElementById('pendingOrders');
      const acceptedContainer = document.getElementById('acceptedOrders');
      const cancelledContainer = document.getElementById('cancelledOrders');
      const popup = document.getElementById('orderPopup');
      const popupDetails = document.getElementById('popupDetails');
      
      // Initialize tabs
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          const containers = document.querySelectorAll('.order-container');
          containers.forEach(container => container.classList.remove('active'));
          document.getElementById(tab.dataset.tab + 'Orders').classList.add('active');
        });
      });

      // Load orders
      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      displayOrders(orders);

      function generateOrderNumber(date, index) {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const count = String(index + 1).padStart(2, '0');
      return `${year}${month}${day}${count}`;
    }

    function displayOrders(orders) {
      // Clear containers
      ordersContainer.innerHTML = '';
      acceptedContainer.innerHTML = '';
      cancelledContainer.innerHTML = '';

      // Sort orders by date and time
      const sortedOrders = [...orders].sort((a, b) => {
        const dateA = new Date(`${a.date} ${a.time}`);
        const dateB = new Date(`${b.date} ${b.time}`);
        return dateA - dateB;
      });

      sortedOrders.forEach((order, index) => {
        // Generate order number if it doesn't exist
        if (!order.orderNumber) {
          order.orderNumber = generateOrderNumber(order.date, index);
          // Update the order in localStorage
          const allOrders = JSON.parse(localStorage.getItem('orders') || '[]');
          const orderIndex = allOrders.findIndex(o => o.id === order.id);
          if (orderIndex !== -1) {
            allOrders[orderIndex].orderNumber = order.orderNumber;
            localStorage.setItem('orders', JSON.stringify(allOrders));
          }
        }

        const orderCard = document.createElement('div');
        orderCard.className = 'order-card';
        
        const formattedDate = order.date || 'Not specified';
        const formattedTime = order.time || 'Not specified';
        const serviceCount = order.services ? order.services.length : 0;
        const serviceNames = order.services ? order.services.map(s => s.name).join(', ') : 'No services';
        
        orderCard.innerHTML = `
          <div class="order-summary">
            <div class="order-info">
              <span class="order-number">#${order.orderNumber || order.id}</span>
              <span class="customer-name">${order.user && order.user.name ? order.user.name : 'No Name'}</span>
            </div>
            <div class="order-info">
              <span class="order-date">${formattedDate}</span>
              <span class="order-time">${formattedTime}</span>
            </div>
            <div class="order-services">
              <span>${serviceCount} service${serviceCount !== 1 ? 's' : ''}: ${serviceNames}</span>
            </div>
            ${order.status === 'pending' ? `
            <div class="order-actions">
              <button class="action-btn accept-btn" onclick="event.stopPropagation(); handleOrderAction(this, 'accepted', '${order.id}')">Accept</button>
              <button class="action-btn cancel-btn" onclick="event.stopPropagation(); handleOrderAction(this, 'cancelled', '${order.id}')">Cancel</button>
            </div>
            ` : ''}
          </div>
        `;

          orderCard.addEventListener('click', () => showPopup(order));

          // Add to appropriate container based on status
          if (order.status === 'accepted') {
            acceptedContainer.appendChild(orderCard);
          } else if (order.status === 'cancelled') {
            cancelledContainer.appendChild(orderCard);
          } else {
            ordersContainer.appendChild(orderCard);
          }
        });
      }

      function showPopup(order) {
        popupDetails.innerHTML = `
          <div class="popup-item">
            <div class="popup-label">Order Number</div>
            <div class="popup-value">#${order.orderNumber || order.id || ""}</div>
          </div>
          <div class="popup-item">
            <div class="popup-label">Date</div>
            <div class="popup-value">${order.date || "Not specified"}</div>
          </div>
          <div class="popup-item">
            <div class="popup-label">Time</div>
            <div class="popup-value">${order.time || "Not specified"}</div>
          </div>
          <div class="popup-item">
            <div class="popup-label">Stylist</div>
            <div class="popup-value">${order.stylist && order.stylist.name ? order.stylist.name : 'Not specified'}</div>
          </div>
          <div class="popup-item">
            <div class="popup-label">Customer</div>
            <div class="popup-value">${order.user && order.user.name ? order.user.name : 'Not specified'}</div>
          </div>
          <div class="popup-item" style="grid-column: 1 / -1;">
            <div class="popup-label">Services</div>
            <div class="popup-value">
              ${order.services ? order.services.map(service => `
                <div class="service-item" style="background: #1a1a1a; padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span class="service-name" style="font-weight: 600;">${service.name || 'Not specified'}</span>
                    <span class="service-price" style="color: #90caf9;">${service.price || 'N/A'}</span>
                  </div>
                  <div style="font-size: 12px; color: #bbb;">
                    Duration: ${service.time || 'Not specified'}
                  </div>
                  ${service.description ? `<div style="font-size: 12px; margin-top: 5px; color: #999;">${service.description}</div>` : ''}
                </div>
              `).join('') : 'No services'}
            </div>
          </div>
          ${order.status === 'pending' ? `
          <div class="popup-item" style="grid-column: 1 / -1; display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px;">
            <button class="action-btn cancel-btn" onclick="handleOrderAction(this, 'cancelled', '${order.id}')">Cancel Order</button>
            <button class="action-btn accept-btn" onclick="handleOrderAction(this, 'accepted', '${order.id}')">Accept Order</button>
          </div>` : ''}
        `;
        popup.classList.add('active');
      }

      function closePopup() {
        popup.classList.remove('active');
      }

      function handleOrderAction(button, status, orderId) {
        if (status === 'accepted' && !confirm('Are you sure you want to accept this order?')) {
          return;
        }
        if (status === 'cancelled' && !confirm('Are you sure you want to cancel this order?')) {
          return;
        }
        
        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        const orderIndex = orders.findIndex(order => order.id == orderId);
        
        if (orderIndex !== -1) {
          orders[orderIndex].status = status;
          // Update the order number if this is the first status change
          if (!orders[orderIndex].orderNumber) {
            const today = new Date();
            const orderDate = new Date(orders[orderIndex].date);
            const orderCount = orders.filter(o => {
              const oDate = new Date(o.date);
              return oDate.toDateString() === orderDate.toDateString();
            }).length;
            orders[orderIndex].orderNumber = generateOrderNumber(orders[orderIndex].date, orderCount);
          }
          
          localStorage.setItem('orders', JSON.stringify(orders));
          displayOrders(orders);
          closePopup();
          
          // Show success message
          alert(`Order has been ${status} successfully!`);
        }
      }
    });
  </script>
</body>
</html>
